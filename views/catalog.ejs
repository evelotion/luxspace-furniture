<%- include('partials/header') %>

<div class="pt-32 pb-10 bg-[#FDFBF7]">
  <div class="container mx-auto px-6" data-aos="fade-up">
    <div class="text-xs text-gray-400 uppercase tracking-widest mb-6">
      <a href="/" class="hover:text-yellow-600 transition">Home</a> / 
      <span class="text-gray-600 font-bold">Catalog</span>
    </div>

    <div class="flex flex-col gap-6">
      
      <div class="flex flex-row justify-between items-end border-b border-gray-200 pb-6">
        <div class="w-2/3">
           <h1 class="text-3xl md:text-5xl font-serif text-gray-900 leading-tight">
            <%= currentCategory === 'All' ? 'All Collections' : currentCategory %>
          </h1>
          <p class="text-gray-400 text-xs md:text-sm mt-2 font-light">
             Showing <%= products.length %> curated items
          </p>
        </div>

        <button onclick="toggleFilter()" id="filter-btn" class="group flex items-center gap-2 px-5 py-2.5 bg-white border border-gray-200 rounded-full hover:border-gray-900 transition-all duration-300 shadow-sm active:scale-95">
          <span class="text-xs font-bold uppercase tracking-widest text-gray-900">Filter</span>
          <div class="relative w-4 h-4">
            <svg id="icon-filter" class="w-4 h-4 text-gray-900 transition-transform duration-300 absolute top-0 left-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
            </svg>
            <svg id="icon-close" class="w-4 h-4 text-gray-900 transition-transform duration-300 opacity-0 rotate-90 scale-50 absolute top-0 left-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </div>
        </button>
      </div>

      <div id="filter-drawer" class="hidden overflow-hidden transition-all duration-500 ease-in-out">
        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-inner mb-4">
            <span class="text-[10px] text-gray-400 uppercase tracking-widest font-bold block mb-4">Select Category</span>
            
            <div class="flex flex-wrap gap-3">
                <a href="/product" 
                   class="px-6 py-2 rounded-full text-xs font-bold uppercase tracking-widest border transition duration-300 
                   <%= currentCategory === 'All' 
                       ? 'bg-gray-900 text-white border-gray-900 shadow-md' 
                       : 'bg-gray-50 text-gray-500 border-transparent hover:bg-white hover:border-gray-200' %>">
                   All Items
                </a>

                <% categories.forEach(cat => { %>
                  <a href="/product?category=<%= cat.category %>" 
                     class="px-6 py-2 rounded-full text-xs font-bold uppercase tracking-widest border transition duration-300 
                     <%= currentCategory === cat.category 
                         ? 'bg-gray-900 text-white border-gray-900 shadow-md' 
                         : 'bg-gray-50 text-gray-500 border-transparent hover:bg-white hover:border-gray-200' %>">
                     <%= cat.category %>
                  </a>
                <% }) %>
            </div>
        </div>
      </div>

    </div>
  </div>
</div>

<section id="collection" class="bg-[#FDFBF7] pb-24 relative z-10 min-h-[500px]">
  <div class="container mx-auto px-4 md:px-6"> 
    
    <% if(products.length === 0) { %>
        <div class="text-center py-20 bg-white rounded-3xl border border-dashed border-gray-200 mt-10 shadow-sm">
            <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-300">
                <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
            </div>
            <p class="text-gray-900 text-lg font-serif">Collection Empty</p>
            <p class="text-gray-400 text-sm mb-6">We couldn't find any items in this category.</p>
            <a href="/product" class="text-xs font-bold uppercase tracking-widest text-white bg-gray-900 px-6 py-3 rounded-full hover:bg-yellow-600 transition">View All Products</a>
        </div>
    <% } else { %>

    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-6 mt-8">
      <% products.forEach((product, index) => { %>

      <div
        class="group relative bg-white rounded-2xl shadow-sm hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 border border-gray-100 p-2 md:p-3"
        data-aos="fade-up"
        data-aos-delay="<%= (index % 4) * 50 %>" 
      >
        <div class="relative aspect-square overflow-hidden rounded-xl bg-gray-50 mb-3 flex items-center justify-center">
          <a href="/product/<%= product.id %>" class="absolute inset-0 z-10"></a>
          
          <img
            src="<%= product.image_url %>"
            alt="<%= product.name %>"
            class="w-full h-full object-contain p-4 transform group-hover:scale-110 transition duration-[1.5s]"
          />

          <button
              onclick="addToCartAnimated(this, '<%= product.id %>', '<%= product.image_url %>')"
              class="absolute bottom-3 right-3 z-20 bg-white/90 backdrop-blur text-black w-8 h-8 md:w-9 md:h-9 rounded-full flex items-center justify-center hover:bg-black hover:text-white transition-all duration-300 translate-y-10 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 shadow-lg border border-gray-100"
            >
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
          </button>
        </div>

        <div class="px-1 pb-1">
            <div class="flex justify-between items-start gap-2 mb-1">
                <h4 class="text-sm md:text-base font-serif text-gray-900 leading-tight line-clamp-1 group-hover:text-yellow-600 transition w-full">
                    <a href="/product/<%= product.id %>"><%= product.name %></a>
                </h4>
            </div>
            
            <div class="flex justify-between items-center">
                <p class="text-[10px] text-gray-400 uppercase tracking-widest truncate max-w-[50%]"><%= product.category %></p>
                <span class="text-xs md:text-sm font-bold text-gray-900">
                    <%= new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(product.price) %>
                </span>
            </div>
        </div>
      </div>

      <% }) %>
    </div>
    <% } %>
  </div>
</section>

<script>
    function toggleFilter() {
        const drawer = document.getElementById('filter-drawer');
        const iconFilter = document.getElementById('icon-filter');
        const iconClose = document.getElementById('icon-close');
        const btn = document.getElementById('filter-btn');

        if (drawer.classList.contains('hidden')) {
            // OPEN
            drawer.classList.remove('hidden');
            // Animasi Ikon
            iconFilter.classList.add('opacity-0', 'rotate-90', 'scale-50');
            iconClose.classList.remove('opacity-0', 'rotate-90', 'scale-50');
            // Style Button Aktif
            btn.classList.add('bg-gray-50', 'border-gray-400');
        } else {
            // CLOSE
            drawer.classList.add('hidden');
            // Animasi Ikon
            iconFilter.classList.remove('opacity-0', 'rotate-90', 'scale-50');
            iconClose.classList.add('opacity-0', 'rotate-90', 'scale-50');
            // Reset Style Button
            btn.classList.remove('bg-gray-50', 'border-gray-400');
        }
    }
</script>

<%- include('partials/footer') %>