<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LuxeSpace | Premium Furniture</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Background Gradient Mesh untuk efek Glassmorphism */
      body {
        background-color: #f3f4f6;
        background-image: 
            radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
            radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
            radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
        background-attachment: fixed;
        font-family: "Lato", sans-serif;
      }
      h1, h2, h3, .font-serif {
        font-family: "Playfair Display", serif;
      }

      /* Utility Class untuk Efek Kaca */
      .glass {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
      .glass-dark {
        background: rgba(17, 24, 39, 0.85); /* Gelap transparan */
        backdrop-filter: blur(12px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
    </style>
  </head>
  <body class="text-gray-800 flex flex-col min-h-screen">
    
    <nav class="glass-dark fixed w-full z-50 transition-all duration-300">
      <div class="container mx-auto px-6 py-4 flex justify-between items-center text-white">
        <a
          href="/"
          class="text-2xl font-serif font-bold tracking-[0.2em] hover:text-yellow-500 transition"
          >LUXESPACE.</a
        >
        
        <div class="hidden md:flex items-center space-x-8 text-xs uppercase tracking-widest">
          <a href="/" class="hover:text-yellow-500 transition">Collections</a>

          <% if(currentUser) { %>
              <div class="flex items-center space-x-4">
                  <span class="text-gray-400 normal-case tracking-normal">Hi, <%= currentUser.full_name %></span>
                  
                  <% if(currentUser.role === 'admin') { %>
                      <a href="/admin" class="text-yellow-500 hover:text-yellow-400 font-bold">Admin Panel</a>
                  <% } %>
                  
                  <a href="/auth/logout" class="border border-white/20 px-4 py-2 rounded-full hover:bg-white hover:text-black transition">
                      Logout
                  </a>
              </div>
          <% } else { %>
              <a href="/auth/login" class="hover:text-yellow-500 transition">Login</a>
              <a href="/auth/register" class="bg-white text-black px-5 py-2 rounded-full hover:bg-yellow-500 hover:text-white transition font-bold">
                  Sign Up
              </a>
          <% } %>
        </div>
      </div>
    </nav>

    <div class="h-20"></div>

    <% if(success_msg != '') { %>
        <div class="container mx-auto px-6 mt-6">
            <div class="glass bg-green-500/10 border-green-500/20 text-green-800 px-4 py-3 rounded-lg relative shadow-sm" role="alert">
                <strong class="font-bold">Success!</strong>
                <span class="block sm:inline"><%= success_msg %></span>
            </div>
        </div>
    <% } %>
    
    <% if(error_msg != '') { %>
        <div class="container mx-auto px-6 mt-6">
            <div class="glass bg-red-500/10 border-red-500/20 text-red-800 px-4 py-3 rounded-lg relative shadow-sm" role="alert">
                <strong class="font-bold">Error!</strong>
                <span class="block sm:inline"><%= error_msg %></span>
            </div>
        </div>
    <% } %>

    <main class="flex-grow relative z-10">
        <%- body %>
    </main>

    <footer class="bg-gray-900 text-white py-10 mt-20 border-t border-gray-800 relative z-10">
      <div class="container mx-auto px-6 text-center">
        <h2 class="text-xl font-serif mb-4 text-yellow-500">LUXESPACE.</h2>
        <p class="text-gray-400 text-sm mb-4">
          Elevate your living experience with premium craftsmanship.
        </p>
        <div class="border-t border-gray-800 pt-6 mt-6 w-1/2 mx-auto">
             <p class="text-gray-600 text-xs tracking-wider">
              &copy; <span id="year"></span> LuxeSpace. Designed & Developed by Indra. All Rights Reserved.
            </p>
        </div>
      </div>
    </footer>
    
    <script>
        document.getElementById('year').textContent = new Date().getFullYear();
    </script>

    <button
      onclick="toggleChat()"
      class="fixed bottom-6 right-6 bg-gray-900 text-white p-4 rounded-full shadow-lg hover:bg-yellow-600 transition z-50 flex items-center justify-center w-14 h-14"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
        />
      </svg>
    </button>

    <div
      id="chat-box"
      class="fixed bottom-24 right-6 w-80 bg-white shadow-2xl rounded-lg hidden flex-col overflow-hidden z-50 border border-gray-200"
    >
      <div class="bg-gray-900 text-white p-4 flex justify-between items-center">
        <div>
          <h3 class="font-serif font-bold">LuxeBot AI</h3>
          <p class="text-xs text-gray-400">Interior Consultant</p>
        </div>
        <button onclick="toggleChat()" class="text-gray-400 hover:text-white">
          &times;
        </button>
      </div>

      <div
        id="chat-history"
        class="h-64 overflow-y-auto p-4 bg-stone-50 space-y-3"
      >
        <div class="text-xs text-center text-gray-400">Start consulting...</div>
      </div>

      <div class="p-3 border-t bg-white flex">
        <input
          type="text"
          id="user-input"
          placeholder="Ask about sofa style..."
          class="flex-grow text-sm border-none focus:ring-0 outline-none px-2"
          onkeypress="if(event.key === 'Enter') sendMessage()"
        />
        <button
          onclick="sendMessage()"
          class="text-gray-900 hover:text-yellow-600 font-bold text-sm"
        >
          SEND
        </button>
      </div>
    </div>

    <script>
      function toggleChat() {
        const box = document.getElementById("chat-box");
        box.classList.toggle("hidden");
        box.classList.toggle("flex");
      }

      async function sendMessage() {
        const input = document.getElementById("user-input");
        const history = document.getElementById("chat-history");
        const message = input.value.trim();

        if (!message) return;

        history.innerHTML += `
                <div class="flex justify-end">
                    <div class="bg-gray-200 text-gray-800 p-2 rounded-lg text-sm max-w-[80%]">${message}</div>
                </div>`;
        input.value = "";
        history.scrollTop = history.scrollHeight;

        const loadingId = "loading-" + Date.now();
        history.innerHTML += `
                <div id="${loadingId}" class="flex justify-start">
                    <div class="bg-gray-900 text-white p-2 rounded-lg text-sm italic">Thinking...</div>
                </div>`;
        try {
          const res = await fetch("/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message }),
          });
          const data = await res.json();

          document.getElementById(loadingId).remove();
          history.innerHTML += `
                    <div class="flex justify-start">
                        <div class="bg-gray-900 text-white p-2 rounded-lg text-sm max-w-[80%]">${data.reply}</div>
                    </div>`;
        } catch (err) {
          document.getElementById(loadingId).innerHTML =
            "Error connecting to AI.";
        }
        history.scrollTop = history.scrollHeight;
      }
    </script>
  </body>
</html>